## topo

Topology-related scripts and utilities; currently mostly ESnet-specific Python code that work with Python 2.x
### Installation

`pip install -r requirements.txt`
- Installs the required packages. You will need access to the esnet/neg-tools private repository.

### Running 
`esdb_topo.py`: Contacts ESDB and does a good amount of processing. It creates two output files:
```
    output/devices.json
    output/adjacencies.json
```
These files are meant to be eventually moved to the backend config directory:
```
.../backend/config/topo/
       esnet-devices.json
       esnet-adjcies.json
```

Some SAPs and ports that should be in `devices.json` are missed or misconfigured.

To insert them to our topology correctly we need some more input and further 
of processing. Some of this input is gathered from Graphite:

```
wget -4 https://graphite.es.net/api/west/snmp/?interface_descr= -O input/graphite_ports.json
wget -4 https://graphite.es.net/api/west/sap/ -O input/saps.json
```

After this, the files generated will look like this:
```
input/
    lags.json               - hand-written config file   (*)
    dual_ports.json         - hand-written config file   (*)
    graphite_ports.json     - through wget               (*)
    saps.json               - through wget               (*)
   

output/
    devices.json            - generated by esdb_topo.py  (*)
    adjacencies.json        - generated by esdb_topo.py

```

The last stage of processing is meant to generate an improved `devices.json` file.

`improve_esdb_topo.py` reads the files marked with `(*)` above, then prints a new `devices.json` in STDOUT.

The `esdb_topo.py` and `improve_esdb_topo.py` scripts have various command-line parameters
to decide where to place their output and where to read their input. 

The `generate_topo.py` script calls both scripts in sequence ensuring the output of one is passed as input 
to the other. 

The `run.sh` shell script in turn passes production-ready parameters to `generate_topo.py` .