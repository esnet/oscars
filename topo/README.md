## topo

Topology-related scripts and utilities; currently mostly ESnet-specific Python code that work with Python 2.x

### Installation

`pip install -r requirements.txt`
- Installs the required packages. You will need access to the esnet/neg-tools private repository.

### Running

The `generate_topo.py` script is the main script that calls `esdb_topo.py` and `improve_esdb_topo.py` scripts in sequence ensuring that the output of one is passed as input to the other. 

The `run.sh` shell script in turn passes production-ready parameters to `generate_topo.py` .

`esdb_topo.py`: Contacts ESDB and does a good amount of processing. It creates three output files:

```
    output/devices.json
    output/adjacencies.json
    output/today.json
```

These files are meant to be eventually moved to the backend config directory:

```
.../backend/config/topo/
       esnet-devices.json
       esnet-adjcies.json
```

Some SAPs and ports that should be in `devices.json` are missed or misconfigured.

To insert them to our topology correctly we need some more input and further of processing. Some of this input is gathered from Netbeam:

```
wget -4 https://esnet-netbeam.appspot.com/api/network/esnet/prod/interfaces -O input/netbeam_ports.json
wget -4 https://esnet-netbeam.appspot.com/api/network/esnet/prod/saps -O input/saps.json
```

After this, the files generated will look like this:

```
input/
    lags.json               - hand-written config file   (*)
    dual_ports.json         - hand-written config file   (*)
    netbeam_ports.json      - through wget               (*)
    saps.json               - through wget               (*)

output/
    devices.json            - generated by esdb_topo.py  (*)
    adjacencies.json        - generated by esdb_topo.py
    today.json              - generated by esdb_topo.py
```

The last stage of processing is meant to generate an improved `devices.json` file.

`improve_esdb_topo.py`: Reads the files marked with `(*)` above, then prints a new `devices.json` in STDOUT.

The `esdb_topo.py` and `improve_esdb_topo.py` scripts have various command-line parameters to decide where to place their output and where to read their input.